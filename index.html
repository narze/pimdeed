<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pimdeed</title>
  <link rel="stylesheet" href="/style.css"/>
  <script src="/js/alpine.js"></script>
</head>
<body>
  <div id="app" x-init="$refs.startButton.focus()" x-data="app()" class="fixed inset-0 flex justify-center items-center">
    <div>
      <h1 class="text-3xl text-center">Pimdeed</h1>
      <p class="text-center text-gray-600">Typing Practice</p>
      <input x-model="template" disabled class="w-full my-2 py-2 px-2 shadow appearance-none border border-gray-400 rounded border-white rounded focus:outline-none focus:shadow-outline" type="text" name="text" id="text" />
      <input x-ref="typingInput" x-model="input" x-bind:disabled="isFinished()" class="w-full my-2 mb-4 py-2 px-2 shadow appearance-none border border-gray-400 rounded border-white rounded focus:outline-none focus:shadow-outline" x-on:keydown="type($event)" type="text" name="typing-input" id="typing-input" placeholder="Type here">
      <div class="text-center">
        <template x-if="!started"><p>Press <code>Enter</code> and start typing!</p></template>
        <button x-text="startButtonText()" x-ref="startButton" @click="start()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        </button>
      </div>
      <template x-if="isFinished()">
        <div>
          <p class="my-2 text-center">
            You've done typing! Time: <span x-text="typingTime()"></span>
          </p>
        </div>
      </template>
      <template x-if="started">
        <div>
          <p class="my-2 text-center">
            <span x-text="elapsedTime"></span>
          </p>
        </div>
      </template>
      <a class="mt-6 text-gray-400" href="https://github.com/narze/pimdeed">Github</a>
      <a class="float-right text-gray-400" href="https://100daysofcode.narze.vercel.app">#100DaysOfCode</a>
    </div>
  </div>

  <script type="text/javascript">
    function app() {
      return {
        template: 'the quick brown fox jumps over the lazy dog',
        input: null,
        started: false,
        startTime: null,
        finishTime: null,
        interval: null,
        start() {
          this.input = ""
          this.$refs.typingInput.focus()

          clearInterval(this.interval)
          const self = this
          this.interval = setInterval(() => {
            self.elapsedTime = self.typingTime()
          }, 10);
        },
        isFinished() {
          const finished = this.template == this.input
          if (finished) {
            clearInterval(this.interval)
            this.started = false
            this.$refs.startButton.focus()
          }
          return finished
        },
        type() {
          if (!this.started) {
            this.started = true
            this.startTime = Date.now()
          }
        },
        typingTime() {
          return `${(Date.now() - this.startTime) / 1000}s`
        },
        startButtonText() {
          return this.isFinished() ? 'Restart' : 'Start'
        },
      }
    }
  </script>
</body>
</html>
